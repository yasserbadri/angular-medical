<div class="appointment-container">
  <h2 class="header">PRISE DE RENDEZ-VOUS</h2>

  <form [formGroup]="appointmentForm" (ngSubmit)="onSubmit()">
    <!-- Sélection du médecin -->
    <div class="form-group">
      <label for="doctor">Choisissez un médecin :</label>
      <select 
        id="doctor" 
        formControlName="doctorId" 
        (change)="onDoctorSelect()"
        [disabled]="loading">
        <option value="">-- Sélectionnez un médecin --</option>
        <option *ngFor="let doctor of doctors" [value]="doctor.id">
          Dr. {{doctor.lastName}} {{doctor.firstName}} - {{doctor.specialty}}
        </option>
      </select>
    </div>

    <!-- Affichage des informations du médecin sélectionné -->
    <div *ngIf="selectedDoctor" class="doctor-info">
      <h3>Dr. {{selectedDoctor.lastName}} {{selectedDoctor.firstName}}</h3>
      <p>Spécialité: {{selectedDoctor.specialty}}</p>
      <p>{{selectedDoctor.description}}</p>
    </div>

    <!-- Type de rendez-vous -->
    <div class="form-group">
      <label for="typeSelect">Type de rendez-vous :</label>
      <select 
        id="typeSelect" 
        formControlName="appointmentType"
        [disabled]="loading">
        <option value="cabinet">Au cabinet</option>
        <option value="visio">En ligne</option>
      </select>
    </div>

    <!-- Date du rendez-vous -->
    <div class="form-group">
      <label for="appointmentDate">Date :</label>
      <input 
        type="date" 
        id="appointmentDate" 
        formControlName="date" 
        [min]="today"
        (change)="onDateSelect()"
        [disabled]="loading || !appointmentForm.get('doctorId')?.value">
    </div>

    <!-- Créneaux disponibles -->
    <div class="form-group" *ngIf="availableSlots.length > 0">
      <label>Sélectionnez un créneau :</label>
      <div class="time-slots">
        <button 
          *ngFor="let slot of availableSlots" 
          type="button" 
          (click)="appointmentForm.get('time')?.setValue(slot.time)"
          [class.selected]="appointmentForm.get('time')?.value === slot.time"
          [disabled]="loading">
          {{slot.time}}
        </button>
      </div>
    </div>

    <!-- Message si aucun créneau disponible -->
    <div *ngIf="appointmentForm.get('date')?.value && availableSlots.length === 0 && !loading" class="no-slots">
      Aucun créneau disponible pour cette date.
    </div>

    <!-- Description -->
    <div class="form-group">
      <label for="description">Description (optionnel) :</label>
      <textarea 
        id="description" 
        formControlName="description" 
        rows="3"
        [disabled]="loading"></textarea>
    </div>

    <!-- Bouton de soumission -->
    <button 
      type="submit" 
      [disabled]="appointmentForm.invalid || loading" 
      class="confirm-button">
      {{ loading ? 'En cours...' : 'Confirmer le rendez-vous' }}
    </button>
  </form>
</div>